{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\rudiejd\\\\Documents\\\\crowdrec\\\\app\\\\src\\\\components\\\\SpotifyForm.js\";\nimport { withRouter } from 'react-router-dom';\nimport React, { Component } from 'react';\nimport { Card, Form, Button, Alert, Row } from 'react-bootstrap';\nimport { connect } from 'react-redux';\nimport SpotifyWebApi from 'spotify-web-api-js';\nconst spotify = new SpotifyWebApi();\n\nclass SpotifyForm extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      resultReceived: false,\n      recOutput: {},\n      errorStatus: undefined\n    };\n    this.handleChange = this.handleChange.bind(this);\n    this.handleSubmit = this.handleSubmit.bind(this);\n    this.processResults = this.processResults.bind(this);\n    this.getRecs = this.getRecs.bind(this);\n    this.createPlaylist = this.createPlaylist.bind(this);\n    this.countTracks = this.countTracks.bind(this);\n    this.getRandomTrack = this.getRandomTrack.bind(this);\n  }\n  /**\r\n     * Handle change in the artist value\r\n     * @param {Object} event Event incurred by change\r\n     */\n\n\n  handleChange(event) {\n    this.setState({\n      resultReceived: false,\n      alert: undefined\n    });\n    const {\n      target\n    } = event;\n    const {\n      value\n    } = target;\n    const {\n      name\n    } = target;\n    this.setState({\n      [name]: value\n    });\n    this.render();\n  }\n  /**\r\n     * Handle HTTP errors encountered by updating the state with an error message\r\n     * @param {Object} err\r\n     */\n\n\n  async handleError(err) {\n    switch (err.status) {\n      case 401:\n        this.setState({\n          errorStatus: 'You don\\'t seem to be authorized. Try clicking the button above to authorize with Spotify and try again.',\n          resultReceived: false\n        });\n        break;\n\n      case 429:\n        this.setState({\n          errorStatus: 'Looks like we\\'re making too many requests to Spotify right now. Wait a little bit and try that again.'\n        });\n        break;\n\n      case 501:\n        this.setState({\n          errorStatus: 'Spotify\\'s servers are fried! Check out their status, then try again when they\\'re back up'\n        });\n        break;\n\n      default:\n        console.log(err);\n    }\n  }\n  /**\r\n     * Checks whether a playlist contains is valid. Criteria for validity are:\r\n     *  - playlist attributes are well-defined (no null properties)\r\n     *  - playlist must contain the artist for which user is searching\r\n     * @param {string} id ID of playlist\r\n     * @param {*} artist Name of artist\r\n     * @return {Promise<boolean>} true if playlist is valid, false otherwise\r\n     */\n\n\n  async isPlaylistValid(id, artist) {\n    return spotify.getPlaylistTracks(id).then(pt => {\n      if (pt === undefined) {\n        return;\n      }\n\n      for (const track of pt.items) {\n        if (track === undefined || track.track === null) {\n          continue;\n        } else if (track.track.artists[0].name === artist) {\n          return true;\n        }\n      }\n\n      return false;\n    });\n  }\n  /**\r\n     * Asynchronously counts tracks by a given artist in a given playlist\r\n     * @param {string} id ID of the playlist\r\n     * @param {string} name Name of the artist\r\n     * @param {object} output Reference to output object which should be modified\r\n     * @return {Promise}\r\n     */\n\n\n  async countTracks(id, name, output) {\n    const MAX_SONGS = 200;\n    return spotify.getPlaylistTracks(id).then(pt => {\n      let curSongs = 0;\n\n      for (const track of pt.items) {\n        if (curSongs > MAX_SONGS) break;\n\n        if (track.track != null && track.track.artists[0].name !== name && track.track.artists[0].name !== '') {\n          if (track.track.artists[0].name in output) {\n            output[track.track.artists[0].name]++;\n          } else {\n            output[track.track.artists[0].name] = 1;\n          }\n        }\n\n        curSongs++;\n      }\n    }).catch(err => {\n      if (err.status === 429) {\n        setTimeout(this.countTracks(id, name, output), 500);\n      }\n\n      this.handleError(err);\n    });\n  }\n  /**\r\n     * Gets recommendations for a specific artist and outputs recOutput value in state\r\n     * @param {string} name The name of the artist\r\n     * @return {Promise}\r\n     * /\r\n    * */\n\n\n  async getRecs(name) {\n    debugger;\n    const output = {};\n    const promises = [];\n    await spotify.searchPlaylists(name, {\n      limit: 1\n    }).then(async searchTotal => await spotify.searchPlaylists(name, {\n      limit: 50,\n      offset: Math.floor(Math.random() * (searchTotal.playlists.total / 50))\n    }).then(res => {\n      for (const i of res.playlists.items) {\n        promises.push(this.isPlaylistValid(i.id, name).then(valid => valid ? this.countTracks(i.id, name, output) : null));\n      }\n    })).catch(err => {\n      this.handleError(err);\n    });\n    return Promise.all(promises).then(() => this.setState({\n      recOutput: this.processResults(output),\n      artist: name\n    }));\n  }\n  /**\r\n     * Processesresults from our query to spotify, removing entries beyond a certain threshhold then sorting the object.\r\n     * @return Results\r\n     */\n\n\n  processResults(input) {\n    const processed = {};\n\n    for (const key in input) {\n      if (input[key] > 10) {\n        processed[key] = input[key];\n      }\n    }\n\n    const sorted = Object.fromEntries(Object.entries(processed).sort(([, a], [, b]) => b - a));\n    return sorted;\n  }\n\n  getRandomTrack(band) {\n    return spotify.searchTracks(band, {\n      limit: 1\n    }).then(searchTotal => spotify.searchTracks(band, {\n      limit: 50\n    })).then(tracks => {\n      if (tracks === undefined || tracks.tracks === null) {\n        return this.getRandomTrack(band);\n      } // filter so we only get songs by the artist\n\n\n      let filteredByBand = tracks.tracks.items.filter(song => song.artists[0] = band);\n      console.log('filtered: ');\n      console.log(filteredByBand);\n      console.log('regular: ');\n      console.log(tracks);\n      return filteredByBand[Math.floor(Math.random() * filteredByBand.length)];\n    }).catch(err => {\n      if (err.status === 429) {\n        setTimeout(() => console.log(\"waiting to prevent 429...\"), 500);\n        return this.getRandomTrack(band);\n      } else {\n        this.handleError(err);\n      }\n    });\n  }\n  /**\r\n     * Creates playlist with one random song from each output artist\r\n     */\n\n\n  createPlaylist() {\n    debugger;\n    const promises = [];\n    const trackUris = [];\n    Object.keys(this.state.recOutput).forEach(async artist => {\n      promises.push(this.getRandomTrack(artist).then(track => trackUris.push(track.uri)).catch(err => this.handleError(err)));\n    }); // this.setState({playlistUrl: playlist.external_urls[\"spotify\"]})\n\n    Promise.all(promises).then(() => {\n      if (this.state.errorStatus === undefined) {\n        const addPromises = [];\n        spotify.getMe().then(me => spotify.createPlaylist(me.id, {\n          name: `Recommendations Based on  ${this.state.artist}`,\n          public: false\n        })).then(playlist => {\n          trackUris.forEach(uri => addPromises.push(spotify.addTracksToPlaylist(playlist.id, [uri]).catch(err => {\n            if (err.status === 429) {\n              setTimeout(() => console.log(\"waiting to prevent 429...\"), 500);\n              return spotify.addTracksToPlaylist(playlist.id, [uri]);\n            } else {\n              this.handleError(err);\n            }\n          })));\n          this.setState({\n            playlistUrl: playlist.external_urls.spotify\n          });\n        });\n        Promise.all(addPromises).then(() => this.setState({\n          alert: 'Playlist created! Click below to open it up. Enjoy :)'\n        }));\n      }\n    });\n  }\n  /**\r\n     *  Handles submission of Artist form\r\n     * @param {Object} e Submission event\r\n     * TODO: Error handling\r\n     */\n\n\n  handleSubmit(e) {\n    e.preventDefault();\n    spotify.setAccessToken(this.props.vars.token);\n    this.setState({\n      errorStatus: undefined,\n      alert: undefined\n    });\n    console.log(this.state);\n    spotify.searchArtists(this.state.artist).then(async res => await this.getRecs(res.artists.items[0].name)).then(() => {\n      // Only show recommendations if they're non empty\n      if (this.state.errorStatus === undefined) {\n        if (Object.keys(this.state.recOutput).length === 0) {\n          this.setState({\n            errorStatus: 'Unfortunately, we could not find any recommendations for that artist at this time. Feel free to try another one, or try again since recommendations are randomly generated.'\n          });\n        } else {\n          this.setState({\n            resultReceived: true\n          });\n        }\n      }\n    }).catch(err => {\n      if (err.status === 429) {\n        setTimeout(() => console.log(\"waiting to prevent 429...\"), 500);\n        return this.handleSubmit(e);\n      }\n\n      this.handleError(err);\n    });\n  }\n  /**\r\n     * Render the component\r\n     * @return JSX\r\n     */\n\n\n  render() {\n    return /*#__PURE__*/React.createElement(React.Fragment, null, this.state.alert !== undefined ? /*#__PURE__*/React.createElement(Alert, {\n      className: \"alert-success\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 281,\n        columnNumber: 11\n      }\n    }, this.state.alert, /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 283,\n        columnNumber: 13\n      }\n    }), /*#__PURE__*/React.createElement(\"a\", {\n      href: this.state.playlistUrl,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 284,\n        columnNumber: 13\n      }\n    }, this.state.playlistUrl)) : null, this.state.errorStatus !== undefined ? /*#__PURE__*/React.createElement(Alert, {\n      className: \"alert-danger\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 287,\n        columnNumber: 49\n      }\n    }, this.state.errorStatus) : null, /*#__PURE__*/React.createElement(Card, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 288,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(Card.Body, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 289,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(Card.Title, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 290,\n        columnNumber: 13\n      }\n    }, \"Enter artist's name for recommendations\"), /*#__PURE__*/React.createElement(Form, {\n      onSubmit: this.handleSubmit,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 291,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(Form.Group, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 292,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(Form.Label, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 293,\n        columnNumber: 17\n      }\n    }, \"Artist\"), /*#__PURE__*/React.createElement(Form.Control, {\n      type: \"text\",\n      placeholder: \"Iron Maiden\",\n      name: \"artist\",\n      onChange: this.handleChange,\n      required: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 294,\n        columnNumber: 17\n      }\n    })), /*#__PURE__*/React.createElement(Form.Group, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 296,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(Form.Control, {\n      type: \"submit\",\n      className: \"bg-primary text-light col-8 offset-2\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 297,\n        columnNumber: 17\n      }\n    })), /*#__PURE__*/React.createElement(Form.Group, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 299,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(Form.Control, {\n      type: \"reset\",\n      className: \"bg-primary text-light col-8 offset-2\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 300,\n        columnNumber: 17\n      }\n    }))))), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"d-block\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 306,\n        columnNumber: 9\n      }\n    }, this.state.resultReceived ? /*#__PURE__*/React.createElement(\"h4\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 308,\n        columnNumber: 13\n      }\n    }, \"Recommended Artists for \", this.state.artist) : null, /*#__PURE__*/React.createElement(Row, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 312,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"ul\", {\n      className: \"col-6\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 313,\n        columnNumber: 13\n      }\n    }, this.state.resultReceived ? Object.keys(this.state.recOutput).map(band => /*#__PURE__*/React.createElement(\"li\", {\n      key: band,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 315,\n        columnNumber: 17\n      }\n    }, band, \":\", ' ', this.state.recOutput[band])) : null), this.state.resultReceived ? /*#__PURE__*/React.createElement(Button, {\n      className: \"mt-3 col-6 h-50 w-50\",\n      onClick: this.createPlaylist,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 323,\n        columnNumber: 42\n      }\n    }, \"Create a playlist with songs from these artists\") : null)));\n  }\n\n} // mapping our redux state to box props\n\n\nconst mapStateToProps = state => ({\n  vars: state.vars\n}); // mapping the dispatches from our reducer to box props\n\n\nconst mapDispatchToProps = dispatch => ({\n  change: vName => dispatch({\n    type: 'CHANGE',\n    name: vName\n  })\n});\n\nexport default withRouter(connect(mapStateToProps, mapDispatchToProps)(SpotifyForm));","map":{"version":3,"sources":["C:/Users/rudiejd/Documents/crowdrec/app/src/components/SpotifyForm.js"],"names":["withRouter","React","Component","Card","Form","Button","Alert","Row","connect","SpotifyWebApi","spotify","SpotifyForm","constructor","props","state","resultReceived","recOutput","errorStatus","undefined","handleChange","bind","handleSubmit","processResults","getRecs","createPlaylist","countTracks","getRandomTrack","event","setState","alert","target","value","name","render","handleError","err","status","console","log","isPlaylistValid","id","artist","getPlaylistTracks","then","pt","track","items","artists","output","MAX_SONGS","curSongs","catch","setTimeout","promises","searchPlaylists","limit","searchTotal","offset","Math","floor","random","playlists","total","res","i","push","valid","Promise","all","input","processed","key","sorted","Object","fromEntries","entries","sort","a","b","band","searchTracks","tracks","filteredByBand","filter","song","length","trackUris","keys","forEach","uri","addPromises","getMe","me","public","playlist","addTracksToPlaylist","playlistUrl","external_urls","e","preventDefault","setAccessToken","vars","token","searchArtists","map","mapStateToProps","mapDispatchToProps","dispatch","change","vName","type"],"mappings":"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","sourcesContent":["import {withRouter} from 'react-router-dom';\r\nimport React, {Component} from 'react';\r\nimport {\r\n  Card, Form, Button, Alert, Row,\r\n} from 'react-bootstrap';\r\nimport {connect} from 'react-redux';\r\nimport SpotifyWebApi from 'spotify-web-api-js';\r\n\r\nconst spotify = new SpotifyWebApi();\r\n\r\n\r\nclass SpotifyForm extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {resultReceived: false, recOutput: {}, errorStatus: undefined};\r\n    this.handleChange = this.handleChange.bind(this);\r\n    this.handleSubmit = this.handleSubmit.bind(this);\r\n    this.processResults = this.processResults.bind(this);\r\n    this.getRecs = this.getRecs.bind(this);\r\n    this.createPlaylist = this.createPlaylist.bind(this);\r\n    this.countTracks = this.countTracks.bind(this);\r\n    this.getRandomTrack = this.getRandomTrack.bind(this);\r\n  }\r\n\r\n  /**\r\n     * Handle change in the artist value\r\n     * @param {Object} event Event incurred by change\r\n     */\r\n  handleChange(event) {\r\n    this.setState({resultReceived: false, alert: undefined});\r\n    const {target} = event;\r\n    const {value} = target;\r\n    const {name} = target;\r\n    this.setState({[name]: value});\r\n    this.render();\r\n  }\r\n\r\n  /**\r\n     * Handle HTTP errors encountered by updating the state with an error message\r\n     * @param {Object} err\r\n     */\r\n  async handleError(err) {\r\n    switch (err.status) {\r\n      case 401:\r\n        this.setState({errorStatus: 'You don\\'t seem to be authorized. Try clicking the button above to authorize with Spotify and try again.', resultReceived: false});\r\n        break;\r\n      case 429:\r\n        this.setState({errorStatus: 'Looks like we\\'re making too many requests to Spotify right now. Wait a little bit and try that again.'});\r\n        break;\r\n      case 501:\r\n        this.setState({errorStatus: 'Spotify\\'s servers are fried! Check out their status, then try again when they\\'re back up'});\r\n        break;\r\n      default:\r\n        console.log(err);\r\n    }\r\n  }\r\n\r\n  /**\r\n     * Checks whether a playlist contains is valid. Criteria for validity are:\r\n     *  - playlist attributes are well-defined (no null properties)\r\n     *  - playlist must contain the artist for which user is searching\r\n     * @param {string} id ID of playlist\r\n     * @param {*} artist Name of artist\r\n     * @return {Promise<boolean>} true if playlist is valid, false otherwise\r\n     */\r\n  async isPlaylistValid(id, artist) {\r\n    return spotify.getPlaylistTracks(id)\r\n        .then(\r\n            (pt) => {\r\n              if (pt === undefined) {\r\n                return;\r\n              }\r\n              for (const track of pt.items) {\r\n                if (track === undefined || track.track === null) {\r\n                  continue;\r\n                } else if (track.track.artists[0].name === artist) {\r\n                  return true;\r\n                }\r\n              }\r\n              return false;\r\n            },\r\n        );\r\n  }\r\n\r\n  /**\r\n     * Asynchronously counts tracks by a given artist in a given playlist\r\n     * @param {string} id ID of the playlist\r\n     * @param {string} name Name of the artist\r\n     * @param {object} output Reference to output object which should be modified\r\n     * @return {Promise}\r\n     */\r\n  async countTracks(id, name, output) {\r\n    const MAX_SONGS = 200;\r\n    return spotify.getPlaylistTracks(id).then(\r\n        (pt) => {\r\n          let curSongs = 0;\r\n          for (const track of pt.items) {\r\n            if (curSongs > MAX_SONGS) break;\r\n            if (track.track != null &&\r\n                        track.track.artists[0].name !== name &&\r\n                        track.track.artists[0].name !== '') {\r\n              if (track.track.artists[0].name in output) {\r\n                output[track.track.artists[0].name]++;\r\n              } else {\r\n                output[track.track.artists[0].name] = 1;\r\n              }\r\n            }\r\n            curSongs++;\r\n          }\r\n        },\r\n    ).catch((err) => {\r\n        if (err.status === 429) {\r\n            setTimeout(this.countTracks(id, name, output), 500);\r\n        } \r\n        this.handleError(err)\r\n    });\r\n  }\r\n\r\n  /**\r\n     * Gets recommendations for a specific artist and outputs recOutput value in state\r\n     * @param {string} name The name of the artist\r\n     * @return {Promise}\r\n     * /\r\n    * */\r\n  async getRecs(name) {\r\n    debugger;\r\n    const output = {};\r\n\r\n    const promises = [];\r\n    await spotify.searchPlaylists(name, {limit: 1})\r\n        .then(async (searchTotal) => await spotify.searchPlaylists(name, {limit: 50, offset: Math.floor(Math.random() * (searchTotal.playlists.total / 50))}).then(\r\n            (res) => {\r\n              for (const i of res.playlists.items) {\r\n                promises.push(this.isPlaylistValid(i.id, name)\r\n                    .then((valid) => (valid ? this.countTracks(i.id, name, output) : null)));\r\n              }\r\n            },\r\n        )).catch((err) => {\r\n                this.handleError(err)\r\n        });\r\n\r\n    return Promise.all(promises).then(() => this.setState({recOutput: this.processResults(output), artist: name}));\r\n  }\r\n\r\n  /**\r\n     * Processesresults from our query to spotify, removing entries beyond a certain threshhold then sorting the object.\r\n     * @return Results\r\n     */\r\n  processResults(input) {\r\n    const processed = {};\r\n    for (const key in input) {\r\n      if (input[key] > 10) {\r\n        processed[key] = input[key];\r\n      }\r\n    }\r\n    const sorted = Object.fromEntries(\r\n        Object.entries(processed).sort(([, a], [, b]) => b - a),\r\n    );\r\n    return sorted;\r\n  }\r\n\r\n\r\n  getRandomTrack(band) {\r\n    return spotify.searchTracks(band, {limit: 1})\r\n        .then((searchTotal) => spotify.searchTracks(band, {limit: 50}))\r\n        .then(\r\n            (tracks) => {\r\n              if (tracks === undefined || tracks.tracks === null) {\r\n                  return this.getRandomTrack(band);\r\n              }\r\n              // filter so we only get songs by the artist\r\n              let filteredByBand = tracks.tracks.items.filter(song =>\r\n                song.artists[0] = band\r\n              )\r\n              console.log('filtered: ');\r\n              console.log(filteredByBand);\r\n              console.log('regular: ');\r\n              console.log(tracks);\r\n              return filteredByBand[Math.floor(Math.random() * filteredByBand.length)];\r\n            },\r\n        ).catch(err => { \r\n            \r\n            if (err.status === 429) {\r\n                setTimeout(() => console.log(\"waiting to prevent 429...\"), 500)\r\n                return this.getRandomTrack(band)\r\n            } else {\r\n                this.handleError(err);\r\n            } \r\n            \r\n             \r\n        })\r\n  }\r\n\r\n  /**\r\n     * Creates playlist with one random song from each output artist\r\n     */\r\n  createPlaylist() {\r\n    debugger;\r\n    const promises = [];\r\n    const trackUris = [];\r\n\r\n    Object.keys(this.state.recOutput).forEach(async (artist) => {\r\n      promises.push(\r\n              this.getRandomTrack(artist)\r\n              .then((track) => trackUris.push(track.uri))\r\n              .catch((err) => this.handleError(err)\r\n      ));\r\n    });\r\n\r\n    // this.setState({playlistUrl: playlist.external_urls[\"spotify\"]})\r\n    Promise.all(promises).then(() => {\r\n      if (this.state.errorStatus === undefined) {\r\n        const addPromises = [];\r\n        spotify.getMe()\r\n            .then((me) => spotify.createPlaylist(me.id, {name: `Recommendations Based on  ${this.state.artist}`, public: false}))\r\n            .then((playlist) => {\r\n              trackUris.forEach(\r\n                  (uri) => addPromises.push(\r\n                      spotify.addTracksToPlaylist(playlist.id, [uri])\r\n                      .catch(err => {\r\n                        if (err.status === 429) {\r\n                            setTimeout(() => console.log(\"waiting to prevent 429...\"), 500)\r\n                            return spotify.addTracksToPlaylist(playlist.id, [uri]);\r\n                        } else {\r\n                            this.handleError(err);\r\n                        }\r\n                        \r\n                      })\r\n                      \r\n                    )\r\n              );\r\n              this.setState({playlistUrl: playlist.external_urls.spotify});\r\n            });\r\n        Promise.all(addPromises).then(() => this.setState({alert: 'Playlist created! Click below to open it up. Enjoy :)'}));\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n     *  Handles submission of Artist form\r\n     * @param {Object} e Submission event\r\n     * TODO: Error handling\r\n     */\r\n  handleSubmit(e) {\r\n    e.preventDefault();\r\n    spotify.setAccessToken(this.props.vars.token);\r\n    this.setState({errorStatus: undefined, alert: undefined});\r\n    console.log(this.state);\r\n    spotify.searchArtists(this.state.artist)\r\n        .then(async (res) => await this.getRecs(res.artists.items[0].name))\r\n        .then(() => {\r\n        // Only show recommendations if they're non empty\r\n          if (this.state.errorStatus === undefined) {\r\n            if (Object.keys(this.state.recOutput).length === 0) {\r\n              this.setState(\r\n                  {errorStatus: 'Unfortunately, we could not find any recommendations for that artist at this time. Feel free to try another one, or try again since recommendations are randomly generated.'},\r\n              );\r\n            } else {\r\n              this.setState({resultReceived: true});\r\n            }\r\n          }\r\n        })\r\n        .catch((err) => {\r\n            if (err.status === 429) {\r\n                setTimeout(() => console.log(\"waiting to prevent 429...\"), 500)\r\n                return this.handleSubmit(e);\r\n            } \r\n            this.handleError(err)}\r\n        );\r\n  }\r\n\r\n\r\n  /**\r\n     * Render the component\r\n     * @return JSX\r\n     */\r\n  render() {\r\n    return (\r\n      <>\r\n        {this.state.alert !== undefined ? (\r\n          <Alert className=\"alert-success\">\r\n            {this.state.alert}\r\n            <br />\r\n            <a href={this.state.playlistUrl}>{this.state.playlistUrl}</a>\r\n          </Alert>\r\n        ) : null }\r\n        {this.state.errorStatus !== undefined ? <Alert className=\"alert-danger\">{this.state.errorStatus}</Alert> : null }\r\n        <Card>\r\n          <Card.Body>\r\n            <Card.Title>Enter artist's name for recommendations</Card.Title>\r\n            <Form onSubmit={this.handleSubmit}>\r\n              <Form.Group>\r\n                <Form.Label>Artist</Form.Label>\r\n                <Form.Control type=\"text\" placeholder=\"Iron Maiden\" name=\"artist\" onChange={this.handleChange} required />\r\n              </Form.Group>\r\n              <Form.Group>\r\n                <Form.Control type=\"submit\" className=\"bg-primary text-light col-8 offset-2\" />\r\n              </Form.Group>\r\n              <Form.Group>\r\n                <Form.Control type=\"reset\" className=\"bg-primary text-light col-8 offset-2\" />\r\n              </Form.Group>\r\n            </Form>\r\n          </Card.Body>\r\n        </Card>\r\n\r\n        <div className=\"d-block\">\r\n          {this.state.resultReceived ? (\r\n            <h4>\r\n              Recommended Artists for {this.state.artist}\r\n            </h4>\r\n          ) : null }\r\n          <Row>\r\n            <ul className=\"col-6\">\r\n              {this.state.resultReceived ? Object.keys(this.state.recOutput).map((band) => (\r\n                <li key={band}>\r\n                  {band}\r\n                  :\r\n                  {' '}\r\n                  {this.state.recOutput[band]}\r\n                </li>\r\n              )) : null }\r\n            </ul>\r\n            {this.state.resultReceived ? <Button className=\"mt-3 col-6 h-50 w-50\" onClick={this.createPlaylist}>Create a playlist with songs from these artists</Button> : null}\r\n          </Row>\r\n        </div>\r\n\r\n      </>\r\n\r\n\r\n    );\r\n  }\r\n}\r\n\r\n// mapping our redux state to box props\r\nconst mapStateToProps = (state) => ({\r\n  vars: state.vars,\r\n});\r\n\r\n// mapping the dispatches from our reducer to box props\r\nconst mapDispatchToProps = (dispatch) => ({\r\n  change: (vName) => dispatch({type: 'CHANGE', name: vName}),\r\n\r\n});\r\n\r\nexport default withRouter(connect(mapStateToProps, mapDispatchToProps)(SpotifyForm));\r\n"]},"metadata":{},"sourceType":"module"}